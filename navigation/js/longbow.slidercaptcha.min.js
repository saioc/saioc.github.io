"use strict";function SliderCaptchaOpen(t){function e(t){var e=i(11,40),o=i(11,40);return e+""+n(e)+t+n(o)+o}function i(t,e){return Math.round(Math.random()*(t-e)+e)}function n(t){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(Math.floor(26*Math.random())+"a".charCodeAt(0));return e}function o(){$("#"+s).removeClass("show"),setTimeout(function(){$("#"+s+"_body").html(""),$("#"+s).hide()},300)}var s="slider_captcha";if(window.captcha._this=t,!$("#"+s).length){var a='<div id="'+s+'" class="modal fade" tabindex="-1" role="dialog" aria-hidden="false" style="user-select:none;z-index:100000000;background:rgba(0, 0, 0, 0.5);">                            <div class="modal-dialog modal-dialog-centered mx-auto" style="width:320px"><div class="modal-content"><div class="modal-body"><div id="'+s+'_body" class="slider-captcha my-2"></div>                            <div class="d-flex align-items-center"><div class="text-xs text-muted">© '+theme.sitesName+'</div><div class="slider-captcha-close ml-auto" data-dismiss="modal" aria-label="Close"><i class="iconfont icon-close"></i></div>                        </div></div></div></div></div>';$("body").append(a),$("#"+s+' [data-dismiss="modal"]').on("click",o)}!function(){window.captcha.imgIndex=0,window.captcha.imgId=!1,$("#"+s).show(),setTimeout(function(){$("#"+s).addClass("show"),sliderCaptcha({id:s+"_body",setSrc:function(){return(0==window.captcha.imgId||window.captcha.imgIndex>=3)&&(window.captcha.imgIndex=0,window.captcha.imgId=Math.round(20*Math.random())),window.captcha.imgIndex++,theme.uri+"/images/captcha/"+window.captcha.imgId+".jpg"},reset:function(){window.captcha.imgId=!1},onSuccess:function(t){var n=window.captcha.rand_str;delete window.captcha.rand_str,delete window.captcha.token;var s=i(1,9),a=i(15,25);window.captcha.ticket=e(t.distance),window.captcha.randstr=s+""+n.substring(s,a)+a,window.captcha.spliced=t.spliced,setTimeout(function(){return o(),window.captcha._this.click(),!1},500)},getX:function(t){window.captcha.ticket=0,window.captcha.randstr=0,window.captcha.spliced=0,$.ajax({url:theme.ajaxurl,data:{action:"get_slider_captcha",randstr:e(t)}}).done(function(t){window.captcha.token=t.token,window.captcha.rand_str=t.rand_str,window.captcha.check=t.check})}})},30)}()}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(t){var e=document.getElementById(t.id),i="object"===(void 0===t?"undefined":_typeof(t))&&t;return new n(e,i)}var e=function(){var t=arguments.length,e=arguments[0]||{};"object"!=(void 0===e?"undefined":_typeof(e))&&"function"!=typeof e&&(e={}),1==t&&(e=this,i--);for(var i=1;i<t;i++){var n=arguments[i];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=function(t){return"function"==typeof t&&"number"!=typeof t.nodeType},n=function t(i,n){this.$element=i,this.options=e({},t.DEFAULTS,n),this.$element.style.position="relative",this.$element.style.width=this.options.width+"px",this.$element.style.margin="0 auto",this.init()};n.DEFAULTS={width:280,height:180,PI:Math.PI,sliderL:42,sliderR:9,offset:8,loadingText:slidercaptcha.loading,failedText:slidercaptcha.retry,barText:slidercaptcha.slider,repeatIcon:"iconfont icon-refresh",maxLoadCount:3,localImages:function(){return""},verify:function(t,e){var i=!1;return $.ajax({url:e,data:{datas:JSON.stringify(t)},dataType:"json",type:"post",async:!1,success:function(t){i=JSON.stringify(t),console.log("返回结果："+i)}}),i}},window.sliderCaptcha=t,window.sliderCaptcha.Constructor=n;var o=n.prototype;o.init=function(){this.initDOM(),this.initImg(),this.bindEvents()},o.initDOM=function(){var t=function(t,e){var i=document.createElement(t);return i.className=e,i},n=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i}(this.options.width-2,this.options.height),o=n.cloneNode(!0),s=t("div","sliderContainer"),a=t("i","refreshIcon "+this.options.repeatIcon),r=t("div","sliderMask"),c=t("div","sliderbg"),d=t("div","captcha-slider"),l=t("i","iconfont icon-arrow-r sliderIcon"),h=t("span","sliderText");n.className="captcha-body-bg placeholder",o.className="captcha-body-bar",h.innerHTML=this.options.barText;var p=this.$element;p.appendChild(n),p.appendChild(a),p.appendChild(o),d.appendChild(l),r.appendChild(d),s.appendChild(c),s.appendChild(r),s.appendChild(h),p.appendChild(s);var u={canvas:n,block:o,sliderContainer:s,refreshIcon:a,slider:d,sliderMask:r,sliderIcon:l,text:h,canvasCtx:n.getContext("2d"),blockCtx:o.getContext("2d")};i(Object.assign)?Object.assign(this,u):e(this,u)},o.initImg=function(){var t=this,e=window.navigator.userAgent.indexOf("Trident")>-1,n=this.options.sliderL+2*this.options.sliderR+3,o=function(i,n){var o=t.options.sliderL,s=t.options.sliderR,a=t.options.PI,r=t.x,c=t.y;i.beginPath(),i.moveTo(r,c),i.arc(r+o/2,c-s+2,s,.72*a,2.26*a),i.lineTo(r+o,c),i.arc(r+o+s-2,c+o/2,s,1.21*a,2.78*a),i.lineTo(r+o,c+o),i.lineTo(r,c+o),i.arc(r+s-2,c+o/2,s+.4,2.76*a,1.24*a,!0),i.lineTo(r,c),i.lineWidth=2,i.fillStyle="rgba(255, 255, 255, 0.7)",i.strokeStyle="rgba(255, 255, 255, 0.7)",i.stroke(),i[n](),i.globalCompositeOperation=e?"xor":"destination-over"},s=function(t,e){return Math.round(Math.random()*(e-t)+t)},a=function(e,n){var o=s(e,n);return i(t.options.getX)&&t.options.getX(o),o},r=new Image;r.crossOrigin="Anonymous";var c=0;r.onload=function(){t.x=a(n+10,t.options.width-(n+10)),t.y=s(10+2*t.options.sliderR,t.options.height-(n+10)),o(t.canvasCtx,"fill"),o(t.blockCtx,"clip"),t.canvasCtx.drawImage(r,0,0,t.options.width-2,t.options.height),t.blockCtx.drawImage(r,0,0,t.options.width-2,t.options.height);var e=t.y-2*t.options.sliderR-1,i=t.blockCtx.getImageData(t.x-3,e,n,n);t.block.width=n,t.blockCtx.putImageData(i,0,e+1),t.text.textContent=t.text.getAttribute("data-text")},r.onerror=function(){if(c++,"file:"===window.location.protocol&&(c=t.options.maxLoadCount,console.error("can't load pic resource file from File protocal. Please try http or https")),c>=t.options.maxLoadCount)return t.text.textContent=slidercaptcha.failed,void t.classList.add("text-danger");r.src=t.options.localImages()},r.setSrc=function(){var n="";if(c=0,t.text.classList.remove("text-danger"),i(t.options.setSrc)&&(n=t.options.setSrc()),n&&""!==n||(n="https://picsum.photos/"+t.options.width+"/"+t.options.height+"/?image="+Math.round(20*Math.random())),e){var o=new XMLHttpRequest;o.onloadend=function(t){var e=new FileReader;e.readAsDataURL(t.target.response),e.onloadend=function(t){r.src=t.target.result}},o.open("GET",n),o.responseType="blob",o.send()}else r.src=n},r.setSrc(),this.text.setAttribute("data-text",this.options.barText),this.text.textContent=this.options.loadingText,this.img=r},o.clean=function(){this.canvasCtx.clearRect(0,0,this.options.width,this.options.height),this.blockCtx.clearRect(0,0,this.options.width,this.options.height),this.block.width=this.options.width},o.bindEvents=function(){var t=this;this.$element.addEventListener("selectstart",function(){return!1}),this.refreshIcon.addEventListener("click",function(){t.text.textContent=t.options.barText,i(t.options.reset)&&t.options.reset(),t.reset(),i(t.options.onRefresh)&&t.options.onRefresh.call(t.$element)});var e,n,o=[],s=!1,a=function(i){t.text.classList.contains("text-danger")||(i.preventDefault(),e=i.clientX||i.touches[0].clientX,n=i.clientY||i.touches[0].clientY,s=!0)},r=function(i){if(!s)return!1;var a=i.clientX||i.touches[0].clientX,r=i.clientY||i.touches[0].clientY,c=a-e,d=r-n;if(c<0||c+40>t.options.width)return!1;t.slider.style.left=c-1+"px";var l=(t.options.width-40-20)/(t.options.width-40)*c;t.block.style.left=l+"px",t.sliderContainer.classList.add("sliderContainer_active"),t.sliderMask.style.width=c+4+"px",o.push(Math.round(d))},c=function(n){if(!s)return!1;if(s=!1,(n.clientX||n.changedTouches[0].clientX)===e)return!1;t.sliderContainer.classList.remove("sliderContainer_active"),t.trail=o;var a=t.verify();a.spliced&&a.verified?(t.sliderContainer.classList.add("sliderContainer_success"),i(t.options.onSuccess)&&t.options.onSuccess.call(t.$element,a)):(t.sliderContainer.classList.add("sliderContainer_fail"),i(t.options.onFail)&&t.options.onFail.call(t.$element),setTimeout(function(){t.text.innerHTML=t.options.failedText,t.reset()},1e3))};this.slider.addEventListener("mousedown",a),this.slider.addEventListener("touchstart",a),document.addEventListener("mousemove",r),document.addEventListener("touchmove",r),document.addEventListener("mouseup",c),document.addEventListener("touchend",c),document.addEventListener("mousedown",function(){return!1}),document.addEventListener("touchstart",function(){return!1}),document.addEventListener("swipe",function(){return!1})},o.verify=function(){var t=this.trail,e=parseInt(this.block.style.left),i=!1,n=function(t,e){return t+e},o=function(t){return t*t},s=t.reduce(n)/t.length,a=t.map(function(t){return t-s});return i=0!==Math.sqrt(a.map(o).reduce(n)/t.length),{spliced:Math.abs(e-this.x)<this.options.offset,verified:i,distance:e}},o.reset=function(){this.sliderContainer.classList.remove("sliderContainer_fail"),this.sliderContainer.classList.remove("sliderContainer_success"),this.slider.style.left=0,this.block.style.left=0,this.sliderMask.style.width=0,this.clean(),this.text.setAttribute("data-text",this.text.textContent),this.text.textContent=this.options.loadingText,this.img.setSrc()}}();